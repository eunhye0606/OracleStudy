SELECT USER
FROM DUAL;
--==>>SCOTT

--○ 확인
SELECT *
FROM TBL_상품;
--==>>
/*
H001	바밤바	 600	30
H002	죠스바	 500	20
H003	메로나	 500	30
H004	보석바	 600	70
H005	쌍쌍바	 600	0
H006	수박바	 500	0
H007	빠삐코	 500	0
C001	월드콘	1600	50
C002	빵빠레	1700	10
C003	구구콘	1800	0
C004	메타콘	1500	0
C005	부라보	1500	0
C006	슈퍼콘	1500	0
E001	빵또아	1100	0
E002	셀렉션	1700	0
E003	투데더	2500	0
E004	거북알	1500	0
E005	팥빙수	1500	0
*/
SELECT *
FROM TBL_출고;
--==>>
/*
1	H001	2022-03-11	20	600
2	H002	2022-03-11	5	500
3	H003	2022-03-11	5	500
4	H004	2022-03-11	5	600
5	C001	2022-03-11	10	1600
6	C002	2022-03-11	10	1600
*/


--○ 생성한 프로시저가 제대로 작동하는지의 여부 확인 → 프로시저 호출
EXEC PRC_출고_UPDATE(6, 20);
--==>>PL/SQL 프로시저가 성공적으로 완료되었습니다.

--○ 프로시저 호출 이후 테이블 조회(확인)
SELECT *
FROM TBL_출고;
--==>>
/*
1	H001	2022-03-11	20	600
2	H002	2022-03-11	5	500
3	H003	2022-03-11	5	500
4	H004	2022-03-11	5	600
5	C001	2022-03-11	10	1600
6	C002	2022-03-11	20	1600    ◀ CHECK ~!!!
*/
SELECT *
FROM TBL_상품;
--==>>
/*
H001	바밤바	 600	30
H002	죠스바	 500	20
H003	메로나	 500	30
H004	보석바	 600	70
H005	쌍쌍바	 600	0
H006	수박바	 500	0
H007	빠삐코	 500	0
C001	월드콘	1600	50
C002	빵빠레	1700	0   ◀ CHECK ~!!!
C003	구구콘	1800	0
C004	메타콘	1500	0
C005	부라보	1500	0
C006	슈퍼콘	1500	0
E001	빵또아	1100	0
E002	셀렉션	1700	0
E003	투데더	2500	0
E004	거북알	1500	0
E005	팥빙수	1500	0
*/

--○ 생성한 프로시저가 제대로 작동하는지의 여부 확인 → 프로시저 호출
EXEC PRC_출고_UPDATE(5, 70);
--==>>에러 발생
--==>>ORA-20002: 재고 부족 ~!!!

--○ 프로시저 호출 이후 테이블 조회(확인)
SELECT *
FROM TBL_출고;
--==>>
/*
1	H001	2022-03-11	20	600
2	H002	2022-03-11	5	500
3	H003	2022-03-11	5	500
4	H004	2022-03-11	5	600
5	C001	2022-03-11	10	1600    ◀ CHECK ~!!!
6	C002	2022-03-11	20	1600    
*/
SELECT *
FROM TBL_상품;
--==>>
/*
H001	바밤바	 600	30
H002	죠스바	 500	20
H003	메로나	 500	30  
H004	보석바	 600	70
H005	쌍쌍바	 600	0
H006	수박바	 500	0
H007	빠삐코	 500	0
C001	월드콘	1600	50  ◀ CHECK ~!!!
C002	빵빠레	1700	0   
C003	구구콘	1800	0
C004	메타콘	1500	0
C005	부라보	1500	0
C006	슈퍼콘	1500	0
E001	빵또아	1100	0
E002	셀렉션	1700	0
E003	투데더	2500	0
E004	거북알	1500	0
E005	팥빙수	1500	0
*/
--------------------------------------------------------------------------------
SELECT *
FROM TBL_입고;
--==>>
/*
1	H001	2022-03-11	30	400
2	H001	2022-03-11	20	500
3	H002	2022-03-11	25	450
4	H003	2022-03-11	35	450
5	H004	2022-03-11	75	520
6	C001	2022-03-11	20	1500
7	C001	2022-03-11	20	1500
8	C001	2022-03-11	20	1500
9	C002	2022-03-11	10	1500
10	C002	2022-03-11	10	1500
*/

SELECT *
FROM TBL_상품;
--==>>
/*
H001	바밤바	 600	30
H002	죠스바	 500	20
H003	메로나	 500	30
H004	보석바	 600	70
H005	쌍쌍바	 600	0
H006	수박바	 500	0
H007	빠삐코	 500	0
C001	월드콘	1600	50
C002	빵빠레	1700	0
C003	구구콘	1800	0
C004	메타콘	1500	0
C005	부라보	1500	0
C006	슈퍼콘	1500	0
E001	빵또아	1100	0
E002	셀렉션	1700	0
E003	투데더	2500	0
E004	거북알	1500	0
E005	팥빙수	1500	0
*/

--1번 프로시저 생성 후, 확인
EXEC PRC_입고_UPDATE(10,100); --원래 10개여서 +90개를 한거임.
--==>>PL/SQL 프로시저가 성공적으로 완료되었습니다.
SELECT *
FROM TBL_입고;
--==>>10	C002	2022-03-11	100	1500
SELECT *
FROM TBL_상품;
--==>>C002	빵빠레	1700	90
SELECT *
FROM TBL_출고;

--1번 프로시저 음수입력시
EXEC PRC_입고_UPDATE(10,-100);
--==>>에러발생
--    ORA-20005: 입고수량은 양수만 입력 가능

--1번 프로시저 변동사항없을때
EXEC PRC_입고_UPDATE(1,30);
--==>>에러발생
--    ORA-20006: 변동사항없음. 현재입고수량 :30

-- 데이터 되돌리기
UPDATE TBL_입고
SET 입고수량 = 10
WHERE 입고번호 = 10;

UPDATE TBL_상품
SET 재고수량 = 0
WHERE 상품코드 = 'C002';
--------------------------------------------------------------------------------
--2번 프로시저 생성 후 테스트
SELECT *
FROM TBL_입고;
--==>>
/*
1	H001	2022-03-11	30	400
2	H001	2022-03-11	20	500
3	H002	2022-03-11	25	450
4	H003	2022-03-11	35	450
5	H004	2022-03-11	75	520
6	C001	2022-03-11	20	1500
7	C001	2022-03-11	20	1500
8	C001	2022-03-11	20	1500
9	C002	2022-03-11	10	1500
10	C002	2022-03-11	10	1500
*/
SELECT *
FROM TBL_상품;
--==>>
/*
H001	바밤바	600	30
H002	죠스바	500	20
H003	메로나	500	30
H004	보석바	600	70
H005	쌍쌍바	600	0
H006	수박바	500	0
H007	빠삐코	500	0
C001	월드콘	1600	50
C002	빵빠레	1700	0
C003	구구콘	1800	0
C004	메타콘	1500	0
C005	부라보	1500	0
C006	슈퍼콘	1500	0
E001	빵또아	1100	0
E002	셀렉션	1700	0
E003	투데더	2500	0
E004	거북알	1500	0
E005	팥빙수	1500	0
*/
SELECT *
FROM TBL_출고;
--==>>
/*
1	H001	2022-03-11	20	600
2	H002	2022-03-11	5	500
3	H003	2022-03-11	5	500
4	H004	2022-03-11	5	600
5	C001	2022-03-11	10	1600
6	C002	2022-03-11	20	1600
*/
--1	H001	2022-03-11	30	400 삭제
EXEC PRC_입고_DELETE(1);
--==>>PL/SQL 프로시저가 성공적으로 완료되었습니다.

SELECT *
FROM TBL_입고;
--==>>
/*
2	H001	2022-03-11	20	500
3	H002	2022-03-11	25	450
4	H003	2022-03-11	35	450
5	H004	2022-03-11	75	520
6	C001	2022-03-11	20	1500
7	C001	2022-03-11	20	1500
8	C001	2022-03-11	20	1500
9	C002	2022-03-11	10	1500
10	C002	2022-03-11	10	1500
*/

SELECT *
FROM TBL_상품;
--==>>H001	바밤바	600	60
--테스트 데이터 되돌리기
--1	H001	2022-03-11	30	400 삭제
INSERT INTO TBL_입고(입고번호,상품코드,입고일자,입고수량,입고단가)
VALUES(1,'H001','2022-03-11',30,400);
--==>>1 행 이(가) 삽입되었습니다.

UPDATE TBL_상품
SET 재고수량 = 30
WHERE 상품코드 = 'H001';

--예외상황인 이미 출고가 시작된 컬럼삭제는?
--근데 다 11일인데 시간차때문인가 프로시저가 실행됐다.
--테스트로 PRC_출고_INSERT를 하고 프로시저를 실행시키겠다.
--프로시저 조회
SELECT *
FROM ALL_PROCEDURES
WHERE OBJECT_NAME LIKE 'PRC_%';

SELECT *
FROM ALL_ARGUMENTS
WHERE OBJECT_NAME = 'PRC_출고_INSERT';
-- 상품코드, 출고수량, 출고단가

SELECT *
FROM TBL_상품;
EXEC PRC_출고_INSERT('H001',30,1000);

SELECT *
FROM TBL_출고;
--==>>7	H001	2022-03-14	30	1000
SELECT *
FROM TBL_입고;
--==>>
/*
1	H001	2022-03-11	30	400
2	H001	2022-03-11	20	500
3	H002	2022-03-11	25	450
4	H003	2022-03-11	35	450
5	H004	2022-03-11	75	520
6	C001	2022-03-11	20	1500
7	C001	2022-03-11	20	1500
8	C001	2022-03-11	20	1500
9	C002	2022-03-11	10	1500
10	C002	2022-03-11	10	1500
*/

SELECT *
FROM TBL_상품;
--==>>
/*
H001	바밤바	600	0
H002	죠스바	500	20
H003	메로나	500	30
H004	보석바	600	70
H005	쌍쌍바	600	0
H006	수박바	500	0
H007	빠삐코	500	0
C001	월드콘	1600	50
C002	빵빠레	1700	0
C003	구구콘	1800	0
C004	메타콘	1500	0
C005	부라보	1500	0
C006	슈퍼콘	1500	0
E001	빵또아	1100	0
E002	셀렉션	1700	0
E003	투데더	2500	0
E004	거북알	1500	0
E005	팥빙수	1500	0
*/
EXEC PRC_입고_DELETE(1);
--==>>에러발생
--    ORA-20007: 이미 출고가 시작되어 입고취소 불가.출고일: 2022-03-14
--------------------------------------------------------------------------------
--3번 프로시저 생성 후 테스트
SELECT *
FROM TBL_상품;
--==>>
/*
H001	바밤바	 600	30
H002	죠스바	 500	20
H003	메로나	 500	30
H004	보석바	 600	70
H005	쌍쌍바	 600	0
H006	수박바	 500	0
H007	빠삐코	 500	0
C001	월드콘	1600	50
C002	빵빠레	1700	0
C003	구구콘	1800	0
C004	메타콘	1500	0
C005	부라보	1500	0
C006	슈퍼콘	1500	0
E001	빵또아	1100	0
E002	셀렉션	1700	0
E003	투데더	2500	0
E004	거북알	1500	0
E005	팥빙수	1500	0
*/
SELECT *
FROM TBL_출고;
--==>>
/*
1	H001	2022-03-11	20	600
2	H002	2022-03-11	5	500
3	H003	2022-03-11	5	500
4	H004	2022-03-11	5	600
5	C001	2022-03-11	10	1600
6	C002	2022-03-11	20	1600
*/
EXEC PRC_출고_DELETE(1);
--==>>PL/SQL 프로시저가 성공적으로 완료되었습니다.

SELECT *
FROM TBL_출고;
--==>>
/*
2	H002	2022-03-11	5	500
3	H003	2022-03-11	5	500
4	H004	2022-03-11	5	600
5	C001	2022-03-11	10	1600
6	C002	2022-03-11	20	1600
*/
SELECT *
FROM TBL_상품;
--H001	바밤바	600	50

--테스트 데이터 돌리기
DESC TBL_출고;
INSERT INTO TBL_출고 (출고번호, 상품코드, 출고일자, 출고수량, 출고단가)
--1	H001	2022-03-11	20	600
VALUES(1,'H001','2022-03-11',20,600);

SELECT *
FROM TBL_출고;
--==>>1	H001	2022-03-11	20	600

UPDATE TBL_상품
SET 재고수량 = 30
WHERE 상품코드 = 'H001';

SELECT *
FROM TBL_상품;
--==>>H001	바밤바	600	30

--2번프로시저를 위한 테스트 컬럼 삭제
--7	H001	2022-03-14	30	1000
EXEC PRC_출고_DELETE(7);


EXEC PRC_출고_INSERT('H001',30,1000);

SELECT *
FROM TBL_출고;

EXEC PRC_출고_DELETE(7);

